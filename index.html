<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Cyberpunk Player Menu</title>
<style>
body {margin:0;padding:0;font-family:"Orbitron",sans-serif;background:rgba(0,0,0,0.7);color:#fff;overflow:hidden;}
#menu {position:absolute;left:50%;top:50%;width:400px;transform:translate(-50%,-50%) scale(0.9);background:rgba(10,0,20,0.85);border:2px solid #ff0000;border-radius:15px;padding:20px;box-shadow:0 0 20px #ff0000;transition:transform 0.3s ease,opacity 0.3s ease;opacity:0;}
#menu.show{opacity:1;transform:translate(-50%,-50%) scale(1);}
.title{font-size:28px;text-align:center;color:#ff0033;text-shadow:0 0 10px #ff0033,0 0 20px #ff6699;margin-bottom:15px;animation:glitch 1s infinite;}
@keyframes glitch{0%{text-shadow:0 0 5px #ff0033,2px 2px #ff66aa;}20%{text-shadow:-2px -2px #ff0033,2px 2px #ff66aa;}40%{text-shadow:2px 2px #ff0033,-2px -2px #ff66aa;}60%{text-shadow:-1px 1px #ff0033,1px -1px #ff66aa;}80%{text-shadow:1px -1px #ff0033,-1px 1px #ff66aa;}100%{text-shadow:0 0 5px #ff0033,2px 2px #ff66aa;}}
#player-list{max-height:300px;overflow-y:auto;}
.player-btn{background:rgba(255,0,0,0.2);border:1px solid #ff0033;border-radius:10px;padding:10px;margin-bottom:8px;cursor:pointer;color:#fff;text-shadow:0 0 5px #ff0033;transition:all 0.2s ease;}
.player-btn.selected{background:rgba(255,0,0,0.6);transform:scale(1.05);box-shadow:0 0 15px #ff0033;}
.hint{margin-top:10px;text-align:center;font-size:14px;color:#ff3366;}
</style>
</head>
<body>
<div id="menu" class="hidden">
    <div class="title">NEARBY PLAYERS</div>
    <div id="player-list"></div>
    <div class="hint">Use ↑ ↓ to scroll, ENTER to select</div>
</div>

<script>
let selectedIndex = 0;
let players = [];

// Listen for messages from Lua
window.addEventListener("message", (event) => {
    const data = event.data;
    if(data.action === "open") {
        document.getElementById("menu").classList.add("show");
    } else if(data.action === "close") {
        document.getElementById("menu").classList.remove("show");
    } else if(data.action === "updatePlayers") {
        players = data.players;
        selectedIndex = 0;
        renderPlayers();
    }
});

// Render player list
function renderPlayers() {
    const container = document.getElementById("player-list");
    container.innerHTML = "";
    players.forEach((p,i) => {
        const btn = document.createElement("div");
        btn.className = "player-btn" + (i===selectedIndex ? " selected" : "");
        btn.innerText = p.name + " (" + p.dist.toFixed(1) + "m)";
        container.appendChild(btn);
    });
}

// Listen for keyboard navigation
document.addEventListener("keydown", (e) => {
    if(!document.getElementById("menu").classList.contains("show")) return;

    if(e.key === "ArrowUp") {
        selectedIndex = (selectedIndex - 1 + players.length) % players.length;
        renderPlayers();
    } else if(e.key === "ArrowDown") {
        selectedIndex = (selectedIndex + 1) % players.length;
        renderPlayers();
    } else if(e.key === "Enter") {
        if(players[selectedIndex]) {
            fetch(`https://${GetParentResourceName()}/selectPlayer`, {
                method: "POST",
                headers: {"Content-Type":"application/json"},
                body: JSON.stringify({ped: players[selectedIndex].ped})
            });
        }
    }
});
</script>
</body>
</html>
