<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Cyberpunk Player Menu</title>

<style>
    body { margin:0; padding:0; overflow:hidden; background:transparent; }
    #root { width:100%; height:100%; }
</style>

</head>
<body>
<div id="root"></div> <!-- REMOTE HTML WILL BE INJECTED HERE -->

<script>
let selectedIndex = 0;
let players = [];

/* ================================
   LUA â†’ NUI MESSAGE HANDLER
==================================*/
window.addEventListener("message", (event) => {
    const data = event.data;

    // Load remote HTML into "root"
    if (data.action === "loadHTML") {
        document.getElementById("root").innerHTML = data.html;
        return;
    }

    // Open
    if (data.action === "open") {
        const m = document.getElementById("menu");
        if (m) m.style.display = "block";
        return;
    }

    // Close
    if (data.action === "close") {
        const m = document.getElementById("menu");
        if (m) m.style.display = "none";
        return;
    }

    // Update list of players
    if (data.action === "updatePlayers") {
        players = data.players;
        selectedIndex = 0;
        updateList();
    }
});

/* ================================
   RE-RENDER PLAYER LIST INSIDE THE REMOTE HTML
==================================*/
function updateList() {
    const container = document.getElementById("player-list");
    if (!container) return;

    container.innerHTML = "";

    players.forEach((p, i) => {
        const row = document.createElement("div");
        row.className = "player-btn" + (i === selectedIndex ? " selected" : "");
        row.innerText = `${p.name} (${p.dist.toFixed(1)}m)`;
        container.appendChild(row);
    });
}

/* ================================
   KEYBOARD CONTROLS
==================================*/
document.addEventListener("keydown", (e) => {
    const menu = document.getElementById("menu");
    if (!menu || menu.style.display === "none") return;

    if (e.key === "ArrowUp") {
        selectedIndex = (selectedIndex - 1 + players.length) % players.length;
        updateList();
    }
    if (e.key === "ArrowDown") {
        selectedIndex = (selectedIndex + 1) % players.length;
        updateList();
    }
    if (e.key === "Enter") {
        const chosen = players[selectedIndex];
        if (!chosen) return;

        fetch(`https://${GetParentResourceName()}/selectPlayer`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ ped: chosen.ped })
        });
    }
});
</script>

</body>
</html>
