<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Cyberpunk Red Menu</title>

<style>
    body {
        margin: 0;
        background: #000;
        font-family: "Courier New", monospace;
        overflow: hidden;
    }

    #menu {
        width: 420px;
        margin: 50px auto;
        padding: 20px;
        border: 3px solid red;
        background: rgba(25, 0, 0, 0.75);
        color: red;
        box-shadow: 0 0 30px red;
        text-shadow: 0 0 8px red;
        animation: glitch 0.25s infinite;
        display: none;
    }

    #title {
        font-size: 28px;
        font-weight: bold;
        margin-bottom: 12px;
        text-align: center;
    }

    #list {
        max-height: 300px;
        overflow-y: auto;
    }

    .item {
        padding: 8px;
        border-bottom: 1px solid red;
        cursor: pointer;
    }

    .item:hover, .selected {
        background: rgba(255, 0, 0, 0.25);
    }

    @keyframes glitch {
        0% { box-shadow: 0 0 8px red; }
        50% { box-shadow: 0 0 20px red; }
        100% { box-shadow: 0 0 8px red; }
    }
</style>
</head>
<body>

<div id="menu">
    <div id="title">CYBER MENU</div>
    <div id="list"></div>
</div>

<script>
    let players = [];
    let selectedIndex = 0;

    const menu = document.getElementById("menu");
    const list = document.getElementById("list");

    // Receive event from FiveM
    window.addEventListener("message", function (event) {
        if (event.data.action === "show") {
            players = event.data.players;
            buildList();
            selectedIndex = 0;
            updateSelection();
            menu.style.display = "block";
        }

        if (event.data.action === "hide") {
            menu.style.display = "none";
        }
    });

    // Build player list
    function buildList() {
        list.innerHTML = "";
        players.forEach((p, i) => {
            const div = document.createElement("div");
            div.className = "item";
            div.innerText = p.name;
            list.appendChild(div);
        });
    }

    // highlight selected
    function updateSelection() {
        [...document.getElementsByClassName("item")].forEach((d, i) => {
            d.classList.toggle("selected", i === selectedIndex);
        });

        document.getElementsByClassName("item")[selectedIndex]
            .scrollIntoView({ behavior: "smooth", block: "center" });
    }

    // Controls
    document.addEventListener("keydown", e => {
        if (e.key === "ArrowDown") {
            selectedIndex = (selectedIndex + 1) % players.length;
            updateSelection();
        }
        if (e.key === "ArrowUp") {
            selectedIndex = (selectedIndex - 1 + players.length) % players.length;
            updateSelection();
        }
        if (e.key === "Enter") {
            fetch(`https://${GetParentResourceName()}/selectPlayer`, {
                method: "POST",
                body: JSON.stringify({
                    id: players[selectedIndex].id
                })
            });
        }
        if (e.key === "Escape") {
            fetch(`https://${GetParentResourceName()}/close`, {
                method: "POST",
                body: "{}"
            });
        }
    });
// ENABLE THIS FOR WEB PREVIEW
if (!window.invokeNative) {
    menu.style.display = "block"; // show menu on normal websites
}

    
</script>

</body>
</html>
